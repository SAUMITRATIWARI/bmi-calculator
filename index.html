<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BMI Calculator</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  
  <!-- Chart.js and PDFLib -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    input[type=range] { width: 100%; }
    #bmiChart { max-width: 400px; margin: auto; }
    .diet-card { background-color: #f8f9fa; border-radius: 10px; padding: 15px; margin-top: 15px; }
    .category-box { font-size: 1.3rem; font-weight: bold; }
  </style>
</head>
<body class="bg-light text-dark">

  <div class="container py-5" id="capture">
    <h2 class="text-center mb-4">BMI Calculator</h2>

    <!-- Sliders -->
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="heightRange" class="form-label">Height (cm)</label>
        <input type="range" class="form-range" min="100" max="220" value="170" id="heightRange">
        <input type="text" class="form-control mt-2" id="heightInput" value="170 cm" readonly>
      </div>
      <div class="col-md-6">
        <label for="weightRange" class="form-label">Weight (kg)</label>
        <input type="range" class="form-range" min="30" max="150" value="65" id="weightRange">
        <input type="text" class="form-control mt-2" id="weightInput" value="65 kg" readonly>
      </div>
    </div>

    <!-- âœ… Calculate Button -->
    <div class="text-center mb-4">
      <button class="btn btn-primary px-4" onclick="updateBMI()">Calculate</button>
    </div>

    <!-- Result -->
    <div class="text-center mb-4">
      <div id="bmiValue" class="h4">BMI: --</div>
      <div id="bmiCategory" class="category-box text-primary">Category: --</div>
    </div>

    <!-- Chart -->
    <div>
      <canvas id="bmiChart"></canvas>
    </div>

    <!-- Diet Plan -->
    <div id="dietPlan" class="mt-5">
      <h4 class="text-center">7-Day Vegetarian Diet Plan</h4>
      <div id="dietCards" class="row row-cols-1 row-cols-md-2 g-4 mt-3"></div>
    </div>
  </div>

  <div class="text-center my-4">
    <button class="btn btn-success" onclick="generatePDF()">Download PDF</button>
  </div>

  <script>
    const heightRange = document.getElementById("heightRange");
    const weightRange = document.getElementById("weightRange");
    const heightInput = document.getElementById("heightInput");
    const weightInput = document.getElementById("weightInput");
    const bmiValue = document.getElementById("bmiValue");
    const bmiCategory = document.getElementById("bmiCategory");
    const dietCards = document.getElementById("dietCards");
    let chart;

    const dietPlans = {
      underweight: [
        "Breakfast: Peanut butter toast & banana",
        "Snack: Nuts & dry fruits",
        "Lunch: Paneer curry + roti + rice",
        "Snack: Protein shake + dates",
        "Dinner: Dal + roti + mixed veggies",
        "Snack: Milk with almonds",
        "Hydrate: 3+ liters water daily"
      ],
      healthy: [
        "Breakfast: Oats with fruits",
        "Snack: Fruits or yogurt",
        "Lunch: Dal + roti + sabji + salad",
        "Snack: Roasted chana or makhana",
        "Dinner: Vegetable khichdi",
        "Snack: Buttermilk or green tea",
        "Hydrate: 3 liters water daily"
      ],
      overweight: [
        "Breakfast: Poha or upma with veggies",
        "Snack: Cucumber or carrot sticks",
        "Lunch: Mixed salad + dal + roti",
        "Snack: Green tea + sprouts",
        "Dinner: Soup + steamed veggies",
        "Snack: 1 fruit (apple/orange)",
        "Hydrate: 3-4 liters water daily"
      ]
    };

    function updateBMI() {
      const height = parseInt(heightRange.value);
      const weight = parseInt(weightRange.value);
      const bmi = (weight / ((height / 100) ** 2)).toFixed(1);
      let category = '';
      let plan = [];

      if (bmi < 18.5) {
        category = "Underweight";
        plan = dietPlans.underweight;
        bmiCategory.className = "category-box text-warning";
      } else if (bmi < 25) {
        category = "Healthy";
        plan = dietPlans.healthy;
        bmiCategory.className = "category-box text-success";
      } else {
        category = "Overweight";
        plan = dietPlans.overweight;
        bmiCategory.className = "category-box text-danger";
      }

      bmiValue.innerText = `BMI: ${bmi}`;
      bmiCategory.innerText = `Category: ${category}`;
      heightInput.value = `${height} cm`;
      weightInput.value = `${weight} kg`;

      updateChart(bmi);
      renderDietPlan(plan);
    }

    function updateChart(bmi) {
      const ctx = document.getElementById('bmiChart').getContext('2d');
      if (chart) chart.destroy();
      const value = parseFloat(bmi);
      let data = [value, 40 - value];
      chart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ['Your BMI', 'Remaining to 40'],
          datasets: [{
            data: data,
            backgroundColor: ['#0d6efd', '#e9ecef']
          }]
        },
        options: {
          plugins: {
            legend: { position: 'bottom' },
            tooltip: {
              callbacks: {
                label: function (context) {
                  return `${context.label}: ${context.parsed.toFixed(1)} (${(context.parsed / 40 * 100).toFixed(1)}%)`;
                }
              }
            }
          }
        }
      });
    }

    function renderDietPlan(plan) {
      dietCards.innerHTML = '';
      plan.forEach((item, index) => {
        const card = document.createElement("div");
        card.className = "col";
        card.innerHTML = `
          <div class="diet-card shadow-sm">
            <strong>Day ${index + 1}</strong><br>${item}
          </div>
        `;
        dietCards.appendChild(card);
      });
    }

    function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'mm', 'a4');
      html2canvas(document.getElementById("capture")).then(canvas => {
        const imgData = canvas.toDataURL('image/png');
        const pageWidth = doc.internal.pageSize.getWidth();
        const imgProps = doc.getImageProperties(imgData);
        const imgHeight = (imgProps.height * pageWidth) / imgProps.width;
        doc.addImage(imgData, 'PNG', 0, 10, pageWidth, imgHeight);
        doc.save("bmi-report.pdf");
      });
    }

    // Sync inputs on slider move
    heightRange.addEventListener("input", () => {
      heightInput.value = `${heightRange.value} cm`;
    });

    weightRange.addEventListener("input", () => {
      weightInput.value = `${weightRange.value} kg`;
    });
  </script>
</body>
</html>
